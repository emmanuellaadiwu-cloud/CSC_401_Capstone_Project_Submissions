{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "a580852c-9344-4a7b-8ebf-d1ae0e8efcc1",
   "metadata": {},
   "outputs": [],
   "source": [
    "!pip install -q pandas scikit-learn openpyxl joblib matplotlib\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "c5d1f660-b988-4b63-854d-0db4216df4f9",
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Gallstone Status</th>\n",
       "      <th>Age</th>\n",
       "      <th>Gender</th>\n",
       "      <th>Comorbidity</th>\n",
       "      <th>Coronary Artery Disease (CAD)</th>\n",
       "      <th>Hypothyroidism</th>\n",
       "      <th>Hyperlipidemia</th>\n",
       "      <th>Diabetes Mellitus (DM)</th>\n",
       "      <th>Height</th>\n",
       "      <th>Weight</th>\n",
       "      <th>...</th>\n",
       "      <th>High Density Lipoprotein (HDL)</th>\n",
       "      <th>Triglyceride</th>\n",
       "      <th>Aspartat Aminotransferaz (AST)</th>\n",
       "      <th>Alanin Aminotransferaz (ALT)</th>\n",
       "      <th>Alkaline Phosphatase (ALP)</th>\n",
       "      <th>Creatinine</th>\n",
       "      <th>Glomerular Filtration Rate (GFR)</th>\n",
       "      <th>C-Reactive Protein (CRP)</th>\n",
       "      <th>Hemoglobin (HGB)</th>\n",
       "      <th>Vitamin D</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>0</td>\n",
       "      <td>50</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>185</td>\n",
       "      <td>92.8</td>\n",
       "      <td>...</td>\n",
       "      <td>40.0</td>\n",
       "      <td>134.0</td>\n",
       "      <td>20.0</td>\n",
       "      <td>22.0</td>\n",
       "      <td>87.0</td>\n",
       "      <td>0.82</td>\n",
       "      <td>112.47</td>\n",
       "      <td>0.0</td>\n",
       "      <td>16.0</td>\n",
       "      <td>33.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>0</td>\n",
       "      <td>47</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>176</td>\n",
       "      <td>94.5</td>\n",
       "      <td>...</td>\n",
       "      <td>43.0</td>\n",
       "      <td>103.0</td>\n",
       "      <td>14.0</td>\n",
       "      <td>13.0</td>\n",
       "      <td>46.0</td>\n",
       "      <td>0.87</td>\n",
       "      <td>107.10</td>\n",
       "      <td>0.0</td>\n",
       "      <td>14.4</td>\n",
       "      <td>25.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>0</td>\n",
       "      <td>61</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>171</td>\n",
       "      <td>91.1</td>\n",
       "      <td>...</td>\n",
       "      <td>43.0</td>\n",
       "      <td>69.0</td>\n",
       "      <td>18.0</td>\n",
       "      <td>14.0</td>\n",
       "      <td>66.0</td>\n",
       "      <td>1.25</td>\n",
       "      <td>65.51</td>\n",
       "      <td>0.0</td>\n",
       "      <td>16.2</td>\n",
       "      <td>30.2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>0</td>\n",
       "      <td>41</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>168</td>\n",
       "      <td>67.7</td>\n",
       "      <td>...</td>\n",
       "      <td>59.0</td>\n",
       "      <td>53.0</td>\n",
       "      <td>20.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>34.0</td>\n",
       "      <td>1.02</td>\n",
       "      <td>94.10</td>\n",
       "      <td>0.0</td>\n",
       "      <td>15.4</td>\n",
       "      <td>35.4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>0</td>\n",
       "      <td>42</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>178</td>\n",
       "      <td>89.6</td>\n",
       "      <td>...</td>\n",
       "      <td>30.0</td>\n",
       "      <td>326.0</td>\n",
       "      <td>27.0</td>\n",
       "      <td>54.0</td>\n",
       "      <td>71.0</td>\n",
       "      <td>0.82</td>\n",
       "      <td>112.47</td>\n",
       "      <td>0.0</td>\n",
       "      <td>16.8</td>\n",
       "      <td>40.6</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows Ã— 39 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "   Gallstone Status  Age  Gender  Comorbidity  Coronary Artery Disease (CAD)  \\\n",
       "0                 0   50       0            0                              0   \n",
       "1                 0   47       0            1                              0   \n",
       "2                 0   61       0            0                              0   \n",
       "3                 0   41       0            0                              0   \n",
       "4                 0   42       0            0                              0   \n",
       "\n",
       "   Hypothyroidism  Hyperlipidemia  Diabetes Mellitus (DM)  Height  Weight  \\\n",
       "0               0               0                       0     185    92.8   \n",
       "1               0               0                       0     176    94.5   \n",
       "2               0               0                       0     171    91.1   \n",
       "3               0               0                       0     168    67.7   \n",
       "4               0               0                       0     178    89.6   \n",
       "\n",
       "   ...  High Density Lipoprotein (HDL)  Triglyceride  \\\n",
       "0  ...                            40.0         134.0   \n",
       "1  ...                            43.0         103.0   \n",
       "2  ...                            43.0          69.0   \n",
       "3  ...                            59.0          53.0   \n",
       "4  ...                            30.0         326.0   \n",
       "\n",
       "   Aspartat Aminotransferaz (AST)  Alanin Aminotransferaz (ALT)  \\\n",
       "0                            20.0                          22.0   \n",
       "1                            14.0                          13.0   \n",
       "2                            18.0                          14.0   \n",
       "3                            20.0                          12.0   \n",
       "4                            27.0                          54.0   \n",
       "\n",
       "   Alkaline Phosphatase (ALP)  Creatinine  Glomerular Filtration Rate (GFR)  \\\n",
       "0                        87.0        0.82                            112.47   \n",
       "1                        46.0        0.87                            107.10   \n",
       "2                        66.0        1.25                             65.51   \n",
       "3                        34.0        1.02                             94.10   \n",
       "4                        71.0        0.82                            112.47   \n",
       "\n",
       "   C-Reactive Protein (CRP)  Hemoglobin (HGB)  Vitamin D  \n",
       "0                       0.0              16.0       33.0  \n",
       "1                       0.0              14.4       25.0  \n",
       "2                       0.0              16.2       30.2  \n",
       "3                       0.0              15.4       35.4  \n",
       "4                       0.0              16.8       40.6  \n",
       "\n",
       "[5 rows x 39 columns]"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import pandas as pd\n",
    "df = pd.read_csv(\"gallstone.csv\")\n",
    "df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "90a3b7f5-0409-4adf-8896-611dc7345428",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "Index(['Gallstone Status', 'Age', 'Gender', 'Comorbidity',\n",
       "       'Coronary Artery Disease (CAD)', 'Hypothyroidism', 'Hyperlipidemia',\n",
       "       'Diabetes Mellitus (DM)', 'Height', 'Weight', 'Body Mass Index (BMI)',\n",
       "       'Total Body Water (TBW)', 'Extracellular Water (ECW)',\n",
       "       'Intracellular Water (ICW)',\n",
       "       'Extracellular Fluid/Total Body Water (ECF/TBW)',\n",
       "       'Total Body Fat Ratio (TBFR) (%)', 'Lean Mass (LM) (%)',\n",
       "       'Body Protein Content (Protein) (%)', 'Visceral Fat Rating (VFR)',\n",
       "       'Bone Mass (BM)', 'Muscle Mass (MM)', 'Obesity (%)',\n",
       "       'Total Fat Content (TFC)', 'Visceral Fat Area (VFA)',\n",
       "       'Visceral Muscle Area (VMA) (Kg)', 'Hepatic Fat Accumulation (HFA)',\n",
       "       'Glucose', 'Total Cholesterol (TC)', 'Low Density Lipoprotein (LDL)',\n",
       "       'High Density Lipoprotein (HDL)', 'Triglyceride',\n",
       "       'Aspartat Aminotransferaz (AST)', 'Alanin Aminotransferaz (ALT)',\n",
       "       'Alkaline Phosphatase (ALP)', 'Creatinine',\n",
       "       'Glomerular Filtration Rate (GFR)', 'C-Reactive Protein (CRP)',\n",
       "       'Hemoglobin (HGB)', 'Vitamin D'],\n",
       "      dtype='object')"
      ]
     },
     "execution_count": 7,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df.columns\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "ab3ac886-fd32-4aae-8b3f-fe550f4a78bd",
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(   Gallstone Status  Age  Gender  Comorbidity  Coronary Artery Disease (CAD)  \\\n",
       " 0                 0   50       0            0                              0   \n",
       " 1                 0   47       0            1                              0   \n",
       " 2                 0   61       0            0                              0   \n",
       " 3                 0   41       0            0                              0   \n",
       " 4                 0   42       0            0                              0   \n",
       " \n",
       "    Hypothyroidism  Hyperlipidemia  Diabetes Mellitus (DM)  Height  Weight  \\\n",
       " 0               0               0                       0     185    92.8   \n",
       " 1               0               0                       0     176    94.5   \n",
       " 2               0               0                       0     171    91.1   \n",
       " 3               0               0                       0     168    67.7   \n",
       " 4               0               0                       0     178    89.6   \n",
       " \n",
       "    ...  High Density Lipoprotein (HDL)  Triglyceride  \\\n",
       " 0  ...                            40.0         134.0   \n",
       " 1  ...                            43.0         103.0   \n",
       " 2  ...                            43.0          69.0   \n",
       " 3  ...                            59.0          53.0   \n",
       " 4  ...                            30.0         326.0   \n",
       " \n",
       "    Aspartat Aminotransferaz (AST)  Alanin Aminotransferaz (ALT)  \\\n",
       " 0                            20.0                          22.0   \n",
       " 1                            14.0                          13.0   \n",
       " 2                            18.0                          14.0   \n",
       " 3                            20.0                          12.0   \n",
       " 4                            27.0                          54.0   \n",
       " \n",
       "    Alkaline Phosphatase (ALP)  Creatinine  Glomerular Filtration Rate (GFR)  \\\n",
       " 0                        87.0        0.82                            112.47   \n",
       " 1                        46.0        0.87                            107.10   \n",
       " 2                        66.0        1.25                             65.51   \n",
       " 3                        34.0        1.02                             94.10   \n",
       " 4                        71.0        0.82                            112.47   \n",
       " \n",
       "    C-Reactive Protein (CRP)  Hemoglobin (HGB)  Vitamin D  \n",
       " 0                       0.0              16.0       33.0  \n",
       " 1                       0.0              14.4       25.0  \n",
       " 2                       0.0              16.2       30.2  \n",
       " 3                       0.0              15.4       35.4  \n",
       " 4                       0.0              16.8       40.6  \n",
       " \n",
       " [5 rows x 38 columns],\n",
       " 0     9\n",
       " 1    15\n",
       " 2    15\n",
       " 3     6\n",
       " 4     8\n",
       " Name: Visceral Fat Rating (VFR), dtype: int64)"
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "TARGET = \"Visceral Fat Rating (VFR)\"\n",
    "if TARGET not in df.columns:\n",
    "    raise ValueError(f\"Target column '{TARGET}' not found.\")\n",
    "X = df.drop(columns=[TARGET])\n",
    "y = df[TARGET]\n",
    "X.head(), y.head()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "96a97474-59a1-436f-a422-929c3e76942f",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "((255, 38), (64, 38))"
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "from sklearn.model_selection import train_test_split\n",
    "X_train, X_test, y_train, y_test = train_test_split(\n",
    "    X, y, test_size=0.2, random_state=42\n",
    ")\n",
    "X_train.shape, X_test.shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "10923602-811f-4058-9dd0-884a7e414ead",
   "metadata": {},
   "outputs": [],
   "source": [
    "from sklearn.pipeline import Pipeline\n",
    "from sklearn.preprocessing import StandardScaler, OneHotEncoder\n",
    "from sklearn.compose import ColumnTransformer\n",
    "from sklearn.impute import SimpleImputer\n",
    "numeric_features = X.select_dtypes(include=['number']).columns.tolist()\n",
    "categorical_features = X.select_dtypes(include=['object', 'category']).columns.tolist()\n",
    "numeric_transformer = Pipeline(steps=[\n",
    "    ('imputer', SimpleImputer(strategy='median')),\n",
    "    ('scaler', StandardScaler())\n",
    "])\n",
    "categorical_transformer = Pipeline(steps=[\n",
    "    ('imputer', SimpleImputer(strategy='most_frequent')),\n",
    "    ('onehot', OneHotEncoder(handle_unknown='ignore'))\n",
    "])\n",
    "preprocessor = ColumnTransformer(transformers=[\n",
    "    ('num', numeric_transformer, numeric_features),\n",
    "    ('cat', categorical_transformer, categorical_features)\n",
    "])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "ed5bfa5d-8580-4e80-8bf9-e287946d77aa",
   "metadata": {},
   "outputs": [],
   "source": [
    "from sklearn.linear_model import LinearRegression\n",
    "from sklearn.ensemble import RandomForestRegressor\n",
    "from sklearn.svm import SVR\n",
    "from sklearn.pipeline import Pipeline\n",
    "models = {\n",
    "    \"LinearRegression\": Pipeline([('preprocessor', preprocessor),\n",
    "                                  ('model', LinearRegression())]),\n",
    "    \"RandomForest\": Pipeline([('preprocessor', preprocessor),\n",
    "                              ('model', RandomForestRegressor(n_estimators=200,\n",
    "                                                              random_state=42))]),\n",
    "    \"SVR\": Pipeline([('preprocessor', preprocessor),\n",
    "                     ('model', SVR())])\n",
    "}"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "369fff39-5f81-4d1d-aa80-c30b8b7a15c2",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[('LinearRegression',\n",
       "  np.float64(0.9992593843942189),\n",
       "  0.7269151022637138,\n",
       "  np.float64(11.575633419301385)),\n",
       " ('RandomForest',\n",
       "  np.float64(1.4662665173835212),\n",
       "  1.0409375,\n",
       "  np.float64(15.994982451295641)),\n",
       " ('SVR',\n",
       "  np.float64(1.7462998265251295),\n",
       "  1.1120646419066038,\n",
       "  np.float64(19.31924350721874))]"
      ]
     },
     "execution_count": 14,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import numpy as np\n",
    "from sklearn.metrics import mean_squared_error, mean_absolute_error\n",
    "results = []\n",
    "def rmse(y_true, y_pred):\n",
    "    return np.sqrt(mean_squared_error(y_true, y_pred))\n",
    "def mape(y_true, y_pred):\n",
    "    y_true, y_pred = np.array(y_true), np.array(y_pred)\n",
    "    mask = y_true != 0\n",
    "    return np.mean(np.abs((y_true[mask] - y_pred[mask]) / y_true[mask])) * 100\n",
    "for name, model in models.items():\n",
    "    model.fit(X_train, y_train)\n",
    "    preds = model.predict(X_test)\n",
    "    model_rmse = rmse(y_test, preds)\n",
    "    model_mae = mean_absolute_error(y_test, preds)\n",
    "    model_mape = mape(y_test, preds)\n",
    "    results.append((name, model_rmse, model_mae, model_mape))\n",
    "results\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "17294c15-daad-4050-a301-bc66ec7c8d0d",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python [conda env:base] *",
   "language": "python",
   "name": "conda-base-py"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.13.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
